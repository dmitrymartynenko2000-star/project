<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –±–ª—é–¥–∞</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .form-group {
            margin-bottom: 15px;
        }
        input, button {
            padding: 10px;
            font-size: 14px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #45a049;
        }
        
        .dish-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 500px;
        }
        
        .dish-image-container {
            position: relative;
            width: 100%;
            height: 200px;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .dish-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .dish-icon {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f0f0f0;
            font-size: 48px;
        }
        
        .dish-name {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        
        .dish-meta {
            color: #666;
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        .price {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 18px;
            display: inline-block;
            margin-bottom: 15px;
        }
        
        .macros {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .macro-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }
        
        .macro-value {
            font-weight: bold;
            font-size: 16px;
            color: #333;
        }
        
        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 15px;
        }
        
        .tag {
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
        }
        
        .recommendations-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px dashed #e1e5e9;
        }

        .recommendations-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .recommendations-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .recommendation-item {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 500;
            box-shadow: 0 2px 5px rgba(76, 175, 80, 0.2);
        }
        
        #result {
            min-height: 100px;
        }
    </style>
</head>
<body>

    <h1>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –±–ª—é–¥–∞</h1>
    <form id="preferencesForm">
        <div class="form-group">
            <label for="calories">–ö–∞–ª–æ—Ä–∏–∏ (–æ—Ç - –¥–æ):</label>
            <input type="text" id="calories" placeholder="–ü—Ä–∏–º–µ—Ä: 400-500">
        </div>
        <div class="form-group">
            <label for="proteins">–ë–µ–ª–∫–∏ (–≥):</label>
            <input type="text" id="proteins" placeholder="–ü—Ä–∏–º–µ—Ä: 20-30">
        </div>
        <div class="form-group">
            <label for="fats">–ñ–∏—Ä—ã (–≥):</label>
            <input type="text" id="fats" placeholder="–ü—Ä–∏–º–µ—Ä: 10-15">
        </div>
        <div class="form-group">
            <label for="carbs">–£–≥–ª–µ–≤–æ–¥—ã (–≥):</label>
            <input type="text" id="carbs" placeholder="–ü—Ä–∏–º–µ—Ä: 40-50">
        </div>
        <button type="submit">–ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</button>
    </form>

    <h2>–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –±–ª—é–¥–æ:</h2>
    <div id="result"></div>

    <script>
        document.getElementById('preferencesForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const calories = document.getElementById('calories').value;
            const proteins = document.getElementById('proteins').value;
            const fats = document.getElementById('fats').value;
            const carbs = document.getElementById('carbs').value;
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
            let query = '';
            if (calories) query += `–∫–∞–ª–æ—Ä–∏–∏ ${calories} `;
            if (proteins) query += `–±–µ–ª–∫–∏ ${proteins} `;
            if (fats) query += `–∂–∏—Ä—ã ${fats} `;
            if (carbs) query += `—É–≥–ª–µ–≤–æ–¥—ã ${carbs} `;
            
            if (!query.trim()) {
                query = '–ª—é–±–æ–µ –±–ª—é–¥–æ';
            }
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            fetch('/recommend', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ query: query.trim() })
            })
            .then(response => response.json())
            .then(data => {
                addBotMessage(data);
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('result').innerHTML = '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏';
            });
        });

        function addBotMessage(data) {
            const dish = data.dish;
            const reason = data.reason;
            const recommendations = data.recommendations || [];

            // –°–æ–∑–¥–∞–µ–º HTML –¥–ª—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
            let recommendationsHTML = '';
            if (recommendations && recommendations.length > 0) {
                recommendationsHTML = `
                    <div class="recommendations-section">
                        <div class="recommendations-title">üçΩÔ∏è –° —ç—Ç–∏–º –æ–±—ã—á–Ω–æ –±–µ—Ä—É—Ç:</div>
                        <div class="recommendations-list">
                            ${recommendations.map(rec => 
                                `<span class="recommendation-item">${rec}</span>`
                            ).join('')}
                        </div>
                    </div>
                `;
            }

            let messageHTML = `
                <div class="dish-card">
                    <div class="dish-image-container">
                        <img src="${dish.image_url}" alt="${dish.name}" class="dish-image" 
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                        <div class="dish-icon" style="display:none;">üçΩÔ∏è</div>
                    </div>
                    
                    <div class="dish-name">${dish.name}</div>
                    
                    <div class="price">${dish.price} ‚ÇΩ</div>
                    
                    <div class="dish-meta">
                        <strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> ${dish.category} | 
                        <strong>–¢–∏–ø:</strong> ${dish.diet}
                    </div>
                    
                    <div class="macros">
                        <div class="macro-item">
                            <div>üî• –ö–∞–ª–æ—Ä–∏–∏</div>
                            <div class="macro-value">${dish.calories} –∫–∫–∞–ª</div>
                        </div>
                        <div class="macro-item">
                            <div>üí™ –ë–µ–ª–∫–∏</div>
                            <div class="macro-value">${dish.proteins} –≥</div>
                        </div>
                        <div class="macro-item">
                            <div>ü•ë –ñ–∏—Ä—ã</div>
                            <div class="macro-value">${dish.fats} –≥</div>
                        </div>
                        <div class="macro-item">
                            <div>üåæ –£–≥–ª–µ–≤–æ–¥—ã</div>
                            <div class="macro-value">${dish.carbs} –≥</div>
                        </div>
                    </div>
                    
                    <div class="tags">
                        ${dish.tags.split(',').map(tag => 
                            `<span class="tag">${tag.trim()}</span>`
                        ).join('')}
                    </div>

                    <div class="reason">
                        <strong>ü§î –ü–æ—á–µ–º—É —Ä–µ–∫–æ–º–µ–Ω–¥—É—é:</strong><br>
                        ${reason}
                    </div>

                    ${recommendationsHTML}
                </div>
            `;

            document.getElementById('result').innerHTML = messageHTML;
        }
    </script>

</body>
</html>
