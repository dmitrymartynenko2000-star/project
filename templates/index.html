<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ç–æ—Ä –±–ª—é–¥</title>
  <style>
    body { font-family: system-ui, Arial, sans-serif; max-width: 720px; margin: 32px auto; padding: 0 16px; }
    .row { display: flex; gap: 8px; }
    input { flex: 1; padding: 12px; font-size: 16px; }
    button { padding: 12px 16px; font-size: 16px; cursor: pointer; }
    pre { background:#f6f6f6; padding:12px; border-radius:8px; white-space:pre-wrap; }
  </style>
</head>
<body>
  <h1>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ç–æ—Ä –±–ª—é–¥</h1>
  <p>–ù–∞–ø–∏—à–∏ —Å–≤–æ–±–æ–¥–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º: ‚Äú—á—Ç–æ-—Ç–æ –ª—ë–≥–∫–æ–µ –±–µ–∑ —Å–≤–∏–Ω–∏–Ω—ã –¥–æ 400 –∫–∫–∞–ª‚Äù, ‚Äú–∫—É—Ä–∏—Ü—É, –Ω–æ –Ω–µ –æ—Å—Ç—Ä–æ‚Äù, –∏ —Ç.–¥.</p>
  <div class="row">
    <input id="q" placeholder="–¢–≤–æ–π –∑–∞–ø—Ä–æ—Å‚Ä¶" />
    <button id="send">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
  </div>
  <h3>–û—Ç–≤–µ—Ç:</h3>
  <pre id="out">‚Äî</pre>

  <script>
    const $q = document.getElementById('q');
    const $out = document.getElementById('out');
    document.getElementById('send').onclick = async () => {
      const query = $q.value.trim();
      if (!query) { $out.textContent = "–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å"; return; }
      $out.textContent = "–î—É–º–∞—é‚Ä¶";
      try {
        const r = await fetch('/recommend', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ query })
        });
        const data = await r.json();
        if (!r.ok) throw new Error(data.error || '–û—à–∏–±–∫–∞');

        const d = data.dish;
        const lines = [
          `ü•ò –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: ${d.name}`,
          `–ü—Ä–∏—á–∏–Ω–∞ (LLM): ${data.reason || '‚Äî'}`,
          `–ö–ë–ñ–£ –±–ª—é–¥–∞: ${d.calories} –∫–∫–∞–ª, –ë:${d.proteins} –ñ:${d.fats} –£:${d.carbs}`,
          `–ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${d.category} | –¢–∏–ø: ${d.diet}`,
          data.used_target_macros && (
            `–¶–µ–ª—å –ö–ë–ñ–£: ` +
            JSON.stringify(data.used_target_macros)
          ) || ''
        ].filter(Boolean);
        $out.textContent = lines.join('\n');
      } catch (e) {
        $out.textContent = '–û—à–∏–±–∫–∞: ' + e.message;
      }
    };
  </script>
</body>
</html>
